{
    "l_app_api.py": "from fastapi import APIRouter\n\nfrom app.api.responses import Responses, response_docs\nfrom app.services.tpl import (\n    TplListSvc,\n)\n\nrouter = APIRouter()\n\n\n@router.get(\n    path=\"/tpls\",\n    summary=\"list\",\n    responses=response_docs(\n        model=TplListSvc,\n    ),\n)\nasync def list_tpl(\n        # current_user: JWTUser = Depends(get_current_user),  # TODO: \u8ba4\u8bc1\n):\n    tpl_svc = TplListSvc()\n    data = await tpl_svc.list_tpl()\n    return Responses.success(data=data)\n",
    "l_app_services.py": "from pydantic import BaseModel, Field\n\n\nclass TplListSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplList\"\n        }\n    }\n    page: int = Field(1, ge=1)\n    size: int = Field(10, ge=1, le=200)\n\n    async def list_tpl(self):\n        # TODO: \u4e1a\u52a1\u903b\u8f91\n        pass\n",
    "s_app_api.py": "from fastapi import APIRouter, Depends\n\nfrom app.api.dependencies import JWTUser, get_current_user\nfrom app.api.responses import Responses, response_docs\nfrom app.services.tpl import (\n    TplListSvc,\n    TplCreateSvc,\n    TplGetSvc,\n    TplDeleteSvc,\n    TplUpdateSvc,\n)\n\nrouter = APIRouter()\n\n# -------------------- \u8bf7\u6839\u636e\u81ea\u8eab\u9700\u6c42\u4fee\u6539 --------------------\n\n\n@router.get(\n    path=\"/tpls\",\n    summary=\"list\",\n    responses=response_docs(\n        model=TplListSvc,\n        is_listwrap=True,\n        listwrap_key=\"items\",\n        listwrap_key_extra={\n            \"total\": \"int\",\n        },\n    ),\n)\nasync def list_tpl(\n        page: int = 1,\n        size: int = 10,\n        current_user: JWTUser = Depends(get_current_user),\n):\n    tpl_svc = TplListSvc(page=page, size=size)\n    data, total = await tpl_svc.list_tpl()\n    return Responses.success(data={\"items\": data, \"total\": total})\n\n\n@router.post(\n    path=\"/tpls\",\n    summary=\"create\",\n    responses=response_docs(data={\n        \"id\": \"int\",\n    }),\n)\nasync def create_tpl(\n        tpl_svc: TplCreateSvc,\n        current_user: JWTUser = Depends(get_current_user),\n):\n    created_id = await tpl_svc.create_tpl()\n    return Responses.success(data={\"id\": created_id})\n\n\n@router.get(\n    path=\"/tpls/{tpl_id}\",\n    summary=\"get\",\n    responses=response_docs(\n        model=TplGetSvc,\n    ),\n)\nasync def get_tpl(\n        tpl_id: int,\n        current_user: JWTUser = Depends(get_current_user),  # \u8ba4\u8bc1\n):\n    tpl_svc = TplGetSvc(tpl_id=tpl_id)\n    data = await tpl_svc.get_tpl()\n    return Responses.success(data=data)\n\n\n@router.delete(\n    path=\"/tpls/{tpl_id}\",\n    summary=\"delete\",\n    responses=response_docs(data={\n        \"id\": \"int\",\n    }),\n)\nasync def delete_tpl(\n        tpl_id: int,\n        current_user: JWTUser = Depends(get_current_user),\n):\n    tpl_svc = TplDeleteSvc(tpl_id=tpl_id)\n    deleted_id = await tpl_svc.delete_tpl()\n    return Responses.success(data={\"id\": deleted_id})\n\n\n@router.put(\n    path=\"/tpls/{tpl_id}\",\n    summary=\"update\",\n    responses=response_docs(data={\n        \"id\": \"int\",\n    }),\n)\nasync def update_tpl(\n        tpl_id: int,\n        tpl_svc: TplUpdateSvc,\n        current_user: JWTUser = Depends(get_current_user),\n):\n    updated_id = await tpl_svc.update_tpl(tpl_id)\n    return Responses.success(data={\"id\": updated_id})\n",
    "s_app_api_nodeclorm.py": "from fastapi import APIRouter\n\nfrom app.api.responses import Responses, response_docs\nfrom app.services.tpl import (\n    TplListSvc,\n)\n\nrouter = APIRouter()\n\n\n@router.get(\n    path=\"/tpls\",\n    summary=\"list\",\n    responses=response_docs(\n        model=TplListSvc,\n    ),\n)\nasync def list_tpl(\n        # current_user: JWTUser = Depends(get_current_user),  # TODO: \u8ba4\u8bc1\n):\n    tpl_svc = TplListSvc()\n    data = await tpl_svc.list_tpl()\n    return Responses.success(data=data)\n",
    "s_app_models.py": "from sqlalchemy import BigInteger, String\nfrom sqlalchemy.orm import mapped_column\n\nfrom app.models import DeclBase\nfrom app.utils.ext_util import gen_snow_id, now_timestamp\n\n\nclass Tpl(DeclBase):\n    __tablename__ = \"tpls\"\n\n    id = mapped_column(BigInteger, primary_key=True, default=gen_snow_id, comment=\"\u4e3b\u952e\")\n    name = mapped_column(String(50), unique=True, index=True, nullable=False, comment=\"\u540d\u79f0\")\n    # #\n    created_at = mapped_column(BigInteger, default=now_timestamp, comment=\"\u521b\u5efa\u65f6\u95f4\")\n    updated_at = mapped_column(BigInteger, default=now_timestamp, onupdate=now_timestamp, comment=\"\u66f4\u65b0\u65f6\u95f4\")\n",
    "s_app_models_nodeclorm.py": "# \u8bf7\u6839\u636e\u81ea\u8eab\u9700\u6c42\u4fee\u6539\nclass Tpl:\n    __tablename__ = \"tpls\"\n",
    "s_app_services.py": "from pydantic import Field, BaseModel\nfrom sqlalchemy.exc import IntegrityError\n\nfrom app.api.exceptions import CustomException\nfrom app.api.status import Status\nfrom app.initializer import g\nfrom app.models.tpl import Tpl\n\n\nclass TplListSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplList\"\n        }\n    }\n    page: int = Field(1, ge=1)\n    size: int = Field(10, ge=1, le=200)\n\n    async def list_tpl(self):\n        async with g.db_async_session() as session:\n            data = await Tpl.fetch_all(\n                session=session,\n                columns=self.response_fields(),\n                offset=(self.page - 1) * self.size,\n                limit=self.size,\n            )\n            total = await Tpl.count(session=session)\n            return data, total\n\n    @staticmethod\n    def response_fields():\n        return (\n            \"id\",\n            \"name\",\n            \"created_at\",\n            \"updated_at\",\n        )\n\n\nclass TplCreateSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplCreate\"\n        }\n    }\n    name: str | None = Field(min_length=1, max_length=50)\n\n    async def create_tpl(self):\n        async with g.db_async_session() as session:\n            result = await Tpl.create(\n                session=session,\n                values={\n                    \"name\": self.name,\n                },\n                on_conflict={\"name\": self.name},\n                flush=True,\n            )\n            if not result:\n                raise CustomException(status=Status.RECORD_EXISTS_ERROR)\n            await session.commit()\n            return result.data[\"id\"]\n\n\nclass TplGetSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplGet\"\n        }\n    }\n    tpl_id: int = Field(...)\n\n    async def get_tpl(self):\n        async with g.db_async_session() as session:\n            data = await Tpl.fetch_one(\n                session=session,\n                where={\"id\": self.tpl_id},\n                columns=self.response_fields(),\n            )\n            if not data:\n                raise CustomException(status=Status.RECORD_NOT_EXIST_ERROR)\n            return data\n\n    @staticmethod\n    def response_fields():\n        return (\n            \"id\",\n            \"name\",\n            \"created_at\",\n            \"updated_at\",\n        )\n\n\nclass TplDeleteSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplDelete\"\n        }\n    }\n    tpl_id: int = Field(...)\n\n    async def delete_tpl(self):\n        async with g.db_async_session() as session:\n            result = await Tpl.delete(\n                session=session,\n                where={\"id\": self.tpl_id},\n            )\n            if not result:\n                raise CustomException(status=Status.RECORD_NOT_EXIST_ERROR)\n            await session.commit()\n            return self.tpl_id\n\n\nclass TplUpdateSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplUpdate\"\n        }\n    }\n    name: str | None = Field(None)\n\n    async def update_tpl(self, tpl_id: int):\n        async with g.db_async_session() as session:\n            try:\n                result = await Tpl.update(\n                    session=session,\n                    where={\"id\": tpl_id},\n                    values=self.model_dump(),\n                )\n                if not result:\n                    raise CustomException(status=Status.RECORD_NOT_EXIST_ERROR)\n                await session.commit()\n            except IntegrityError:\n                raise CustomException(status=Status.RECORD_EXISTS_ERROR)\n            return tpl_id\n",
    "s_app_services_nodeclorm.py": "from pydantic import BaseModel, Field\n\n\nclass TplListSvc(BaseModel):\n    model_config = {\n        \"json_schema_extra\": {\n            \"title\": \"TplList\"\n        }\n    }\n    page: int = Field(1, ge=1)\n    size: int = Field(10, ge=1, le=200)\n\n    async def list_tpl(self):\n        # TODO: \u4e1a\u52a1\u903b\u8f91\n        pass\n",
    "t_app_api.py": "from fastapi import APIRouter\n\nfrom app.api.responses import Responses, response_docs\n\nrouter = APIRouter()\n\n\n@router.get(\n    path=\"/tpls\",\n    summary=\"list\",\n    responses=response_docs(),\n)\nasync def list_tpl(\n        # current_user: JWTUser = Depends(get_current_user),  # TODO: \u8ba4\u8bc1\n):\n    data = {}  # TODO: \u6570\u636e\n    return Responses.success(data=data)\n"
}